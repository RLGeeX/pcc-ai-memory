{
  "permissions": {
    "allow": [
      "Bash(gemini -p \"$(cat <<''EOF''\nResearch comprehensive Terraform patterns for GCP Apigee X provisioning including:\n1. google_apigee_organization resource configuration\n2. google_apigee_environment setup with service accounts\n3. google_apigee_instance for runtime instances\n4. IAM bindings for Apigee service accounts\n5. Artifact Registry integration\n6. Secret Manager for API credentials\n7. GCS bucket for OpenAPI specs storage\n\nProvide complete Terraform module examples following Google best practices.\nInclude variable definitions, outputs, and proper dependency management.\nFocus on production-ready patterns with error handling and documentation.\nEOF\n)\")",
      "mcp__context7__resolve-library-id",
      "mcp__context7__get-library-docs",
      "mcp__jira-pcc__getAccessibleAtlassianResources",
      "mcp__jira-ti__getAccessibleAtlassianResources",
      "mcp__jira-pcc__createJiraIssue",
      "Bash(head:*)",
      "mcp__jira-pcc__getTransitionsForJiraIssue",
      "mcp__jira-pcc__transitionJiraIssue",
      "mcp__jira-pcc__getJiraIssue",
      "mcp__jira-pcc__editJiraIssue",
      "mcp__serena__replace_regex",
      "mcp__serena__search_for_pattern",
      "mcp__serena__activate_project",
      "mcp__serena__find_file",
      "mcp__jira-pcc__atlassianUserInfo",
      "Bash(find:*)",
      "mcp__tavily__tavily-search",
      "Skill(superpowers:brainstorming)",
      "Bash(sed:*)",
      "Bash(awk:*)",
      "mcp__tavily__tavily-extract",
      "mcp__jira-pcc__searchJiraIssuesUsingJql",
      "Bash(timeout 600 gemini -p \"$(cat <<''EOF''\nYou are a GKE Autopilot and ArgoCD expert reviewing a deployment plan.\n\n**Context:**\n- GKE Autopilot cluster: pcc-prj-devops-nonprod\n- Installing ArgoCD via Helm for GitOps management\n- Need to handle Autopilot restrictions (no kube-system access, managed namespaces)\n\n**Question:**\nWhat specific changes are needed for ArgoCD Helm installation on GKE Autopilot?\n\nFocus on:\n1. Helm values.yaml configuration for namespace-scoped mode\n2. RBAC requirements for managing applications in other namespaces\n3. Pre-flight validation checks specific to Autopilot\n4. Any other Autopilot-specific constraints affecting ArgoCD\n\nProvide actionable recommendations with code snippets where applicable.\nEOF\n)\")",
      "Bash(timeout 600 gemini -p \"$(cat <<''EOF''\nYou are reviewing a PLANNING document for Phase 6 ArgoCD deployment on GKE Autopilot.\n\n**IMPORTANT**: This is PLANNING work only. You are NOT implementing anything. A partner will execute this plan using Claude Code (CC) and WARP tools based on these markdown files.\n\n**Context:**\n- Project: PortCo Connect infrastructure (nonprod DevOps cluster)\n- Cluster: pcc-prj-devops-nonprod (GKE Autopilot)\n- Purpose: GitOps platform for testing ArgoCD/GKE upgrades\n- Team: Small team, practical security (not enterprise SOC2/NIST)\n\n**24-Phase Plan Summary:**\n\n**Phases 6.1-6.2** [CC]: Create 3 generic Terraform modules (service-account, workload-identity, managed-certificate)\n\n**Phase 6.3** [CC]: Create Terraform config calling modules:\n- 4 service accounts (controller, server, dex, redis)\n- 4 Workload Identity bindings\n- 1 GCP-managed SSL certificate\n- 1 GCS bucket (3-day retention for backups)\n- IAM roles: container.viewer, compute.viewer, logging.logWriter, storage.objectAdmin\n\n**Phase 6.4** [CC]: Create Helm values-autopilot.yaml:\n- Namespace-scoped (no ClusterRoles)\n- Resource requests/limits (Autopilot requirement)\n- Workload Identity annotations\n- Google Workspace Groups RBAC\n- Security contexts (runAsNonRoot)\n\n**Phase 6.5** [WARP]: terraform apply (deploy infrastructure)\n\n**Phase 6.6** [WARP]: Pre-flight validation (Autopilot mode, WI enabled, cluster health)\n\n**Phase 6.7** [WARP]: Merged validation (helm template + policy scan + kubectl dry-run)\n\n**Phase 6.8** [WARP]: helm install argocd --version 7.7.11 --create-namespace\n\n**Phase 6.9** [WARP]: Validate Workload Identity (test metadata server access)\n\n**Phase 6.10** [WARP]: Extract admin password to Secret Manager\n\n**Phase 6.11** [CC]: Prepare Ingress manifest (references GCP-managed cert)\n\n**Phase 6.12** [WARP]: Apply Ingress + manual DNS A record creation\n\n**Phase 6.13** [WARP]: Validate Google Auth (test each group: admins, devops, developers, read-only)\n\n**Phase 6.14** [CC]: Create NetworkPolicy manifests (wide-open egress) + git push\n\n**Phase 6.15** [WARP]: Configure Git credentials (SSH key or PAT)\n\n**Phase 6.16** [CC]: Create app-of-apps manifests + git push\n\n**Phase 6.17** [WARP]: Deploy app-of-apps (ArgoCD syncs NetworkPolicies)\n\n**Phase 6.18** [WARP]: Validate NetworkPolicies applied\n\n**Phase 6.19** [CC]: Create hello-world app manifests + git push\n\n**Phase 6.20** [WARP]: Deploy hello-world (ArgoCD creates namespace via CreateNamespace)\n\n**Phase 6.21** [CC]: Security validation plan documentation\n\n**Phase 6.22** [CC]: Design backup strategy (3-day retention, GCS bucket already in 6.3)\n\n**Phase 6.23** [WARP]: Configure monitoring (Prometheus, Cloud Logging, alerts)\n\n**Phase 6.24** [WARP]: E2E validation (GitOps pipeline, self-healing, upgrade test)\n\n**Your Review:**\n1. Is the GKE Autopilot approach technically sound?\n2. Are the 3 Terraform modules appropriately generic/reusable?\n3. Does Helm configuration properly address Autopilot constraints?\n4. Is the GitOps pattern (app-of-apps, namespace creation) correct?\n5. Any missing technical steps or risks?\n6. Is phase sizing appropriate for human+AI execution?\n\n**Remember**: You''re reviewing the PLAN, not implementing it.\nEOF\n)\")",
      "Bash(timeout 600 codex exec --skip-git-repo-check \"$(cat <<''EOF''\nYou are reviewing a PLANNING document for Phase 6 ArgoCD deployment on GKE Autopilot.\n\n**IMPORTANT**: This is PLANNING work only. You are NOT implementing. A partner executes this plan with Claude Code/WARP tools.\n\n**Context:**\n- GKE Autopilot cluster (pcc-prj-devops-nonprod)\n- Small team, practical security approach\n- Purpose: GitOps testing platform\n\n**24-Phase Plan Summary:**\n\n**Infrastructure (Phases 6.1-6.5)**:\n- Create 3 generic modules: service-account, workload-identity, managed-certificate\n- Terraform config: 4 SAs, 4 WI bindings, 1 SSL cert, 1 GCS bucket (3-day retention)\n- IAM: container.viewer, compute.viewer, logging.logWriter, storage.objectAdmin\n\n**ArgoCD Installation (Phases 6.6-6.10)**:\n- Pre-flight: Autopilot mode check, WI enabled validation\n- Merged validation: helm template + policy scan + admission dry-run (25 min)\n- helm install --version 7.7.11 with namespace-scoped values\n- Validate WI via metadata server\n- Extract admin password to Secret Manager\n\n**Access & Security (Phases 6.11-6.15)**:\n- Create Ingress + manual DNS A record\n- Validate Google Workspace Groups RBAC\n- NetworkPolicies (wide-open egress) managed by ArgoCD GitOps\n- Configure Git credentials (SSH/PAT)\n\n**GitOps Setup (Phases 6.16-6.20)**:\n- App-of-apps for self-management\n- ArgoCD syncs NetworkPolicies from Git\n- Hello-world sample app with CreateNamespace sync option\n\n**Operations (Phases 6.21-6.24)**:\n- Security validation plan\n- Backup strategy documentation (3-day retention)\n- Monitoring: Prometheus + Cloud Logging + alerts\n- E2E: GitOps pipeline + self-healing + upgrade test\n\n**Specific Decisions Made:**\n- Phase 6.4 comes BEFORE 6.5 (Helm values reference SA emails from Terraform config, not outputs)\n- Egress NetworkPolicies: wide open (no restrictions)\n- Secret Manager: project-level IAM sufficient (no secret-level IAM)\n- Backup: 3-day retention (nonprod cost optimization)\n\n**Your Review:**\n1. Technical soundness of Autopilot approach (namespace-scoped, resource limits, security contexts)\n2. Terraform module design (generic, reusable)\n3. Validation strategy (policy scan + admission dry-run merged into 25 min)\n4. GitOps pattern correctness\n5. Phase dependencies and ordering\n6. Any deployment risks or missing steps\n\n**Format**: Provide structured feedback on technical correctness, not implementation details.\nEOF\n)\")",
      "Bash(gcloud alloydb clusters describe:*)",
      "Bash(gcloud alloydb instances describe:*)",
      "Bash(gcloud alloydb instances list:*)",
      "Bash(gcloud compute routers nats list:*)",
      "Bash(gcloud compute routers list:*)",
      "Bash(gcloud compute instances describe:*)"
    ],
    "deny": [],
    "ask": []
  }
}
